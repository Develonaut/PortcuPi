var request=require("request"),parseString=require("xml2js").parseString,_=require("underscore"),db_helper_vars={base_image_url:"http://thegamesdb.net/banners/"};module.exports={getGameList:function(e,t){request("http://thegamesdb.net/api/GetGamesList.php?name="+e,function(e,a,r){var s=null;e||200!=a.statusCode?t("getGameList error"):(parseString(r,function(e,t){s=t.Data.Game}),t(s))})},getPlatformSpecifiedGameList:function(e,t,a){var r="http://thegamesdb.net/api/GetGamesList.php?",s="name="+t,n="&platform="+e,i=r+s+n;request(i,function(e,t,r){var s=null;e||200!=t.statusCode?a("getGameList error"):(parseString(r,function(e,t){s=t.Data.Game}),a(s))})},getPlatformList:function(e){request("http://thegamesdb.net/api/GetPlatformsList.php",function(t,a,r){var s=null;t||200!=a.statusCode?e("getPlatformList Error"):(parseString(r,function(e,t){s=t.Data.Platforms[0].Platform}),e(s))})},getGame:function(e,t){request("http://thegamesdb.net/api/GetGame.php?id="+e,function(e,a,r){var s=null;if(e||200!=a.statusCode)t("getGame Error");else{parseString(r,function(e,t){s=t.Data.Game});var n=s[0],i={},o=_.has(n,"Images");if(game_has_boxart=_.has(n.Images[0],"boxart"),o&&game_has_boxart){var m=n.Images[0].boxart;_.isEmpty(m[0])||(i.front=m[0].$,n.BoxArt=[i]),_.isEmpty(m[1])||(i.front=m[1].$,i.back=m[0].$,n.BoxArt=[i])}var u="",p=_.has(n,"Genres");p&&(u=n.Genres[0].genre[0],n.Genres=[u]),t(s)}})}};